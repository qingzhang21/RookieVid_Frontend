{"ast":null,"code":"import \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport axios from 'axios';\nexport default {\n  data: function data() {\n    return {\n      file: null,\n      // 选择的视频文件对象\n      uploading: false,\n      // 是否正在上传\n      uploadProgress: 0,\n      // 上传进度，0-100\n      dialogImageUrl: '',\n      dialogVisible: false,\n      form: {\n        video: '',\n        cover: '',\n        title: '',\n        label: '',\n        description: ''\n      }\n    };\n  },\n  computed: {\n    // coverUrl() {\n    //   return this.form.cover ? `data:image/jpeg;base64,${this.form.cover}` : require(\"../assets/upload/upload_cover.png\");\n    // },\n  },\n  methods: {\n    handleRemove: function handleRemove(file, fileList) {\n      console.log(file, fileList);\n    },\n    handlePictureCardPreview: function handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url;\n      this.dialogVisible = true;\n    },\n    uploadVideo: function uploadVideo() {\n      var _this = this;\n      if (!this.form.video) {\n        alert('请先选择视频文件');\n        return;\n      }\n      this.uploading = true;\n      var formData = new FormData();\n      formData.append(\"video_file\", this.form.video);\n      formData.append(\"cover_file\", this.form.cover);\n      formData.append(\"label\", this.form.label);\n      formData.append(\"title\", this.form.title);\n      formData.append(\"description\", this.form.description);\n      console.log(this.form);\n      axios.post('/videos/upload_video', formData, {\n        onUploadProgress: function onUploadProgress(progressEvent) {\n          _this.uploadProgress = Math.round(progressEvent.loaded * 100 / progressEvent.total);\n          console.log(_this.uploadProgress);\n        }\n      }).then(function (res) {\n        if (res.errorno == 0) {\n          alert(\"上传成功\");\n        } else {\n          alert(res.data.msg);\n        }\n        console.log(res.data.msg);\n        _this.uploading = false;\n        _this.uploadProgress = 0;\n        // this.uploadProgress = { value: 0, displayValue: '0%' };\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","data","file","uploading","uploadProgress","dialogImageUrl","dialogVisible","form","video","cover","title","label","description","computed","methods","handleRemove","fileList","console","log","handlePictureCardPreview","url","uploadVideo","_this","alert","formData","FormData","append","post","onUploadProgress","progressEvent","Math","round","loaded","total","then","res","errorno","msg"],"sources":["src/views/CreationView.vue"],"sourcesContent":["<template>\n  <div class=\"creation\">\n    <!-- <el-button>上传视频</el-button> -->\n    <div class=\"upload-body\">\n      <el-form :model=\"form\" status-icon:rules=\"rules\" ref=\"form\" label-width=\"100px\" class=\"upload-form\">\n        <!-- <el-upload\n          class=\"upload-demo\"\n          drag\n          action=\"https://jsonplaceholder.typicode.com/posts/\"\n          multiple>\n          <i class=\"el-icon-upload\"></i>\n          <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n          <div class=\"el-upload__tip\" slot=\"tip\">只能上传jpg/png文件，且不超过500kb</div>\n        </el-upload> -->\n        <div class=\"video_info\">\n          <el-form-item label=\"视频标题\" prop=\"title\" style=\"margin-top:20px;width:100%\">\n                <el-input v-model=\"form.title\" ></el-input>\n          </el-form-item>\n          <el-form-item label=\"视频封面\" prop=\"cover\" style=\"margin-top:20px\">\n                <!-- <el-input v-model=\"form.cover\" id=\"upload_cover\" type=\"file\" accept=\".jpg,.png,.jpeg\" style=\"display:none;\" ></el-input>\n                <label for=\"upload_cover\">\n                  <img src=\"../assets/upload/upload_cover.png\" style=\"height: 100px; width:100px;opacity: 0.6;\">\n                </label> -->\n                <el-upload\n                  action=\"https://jsonplaceholder.typicode.com/posts/\"\n                  list-type=\"picture-card\"\n                  :on-preview=\"handlePictureCardPreview\"\n                  :on-remove=\"handleRemove\">\n                  <i class=\"el-icon-plus\"></i>\n                </el-upload>\n                <el-dialog :visible.sync=\"dialogVisible\">\n                  <img width=\"100%\" :src=\"dialogImageUrl\" alt=\"\">\n                </el-dialog>\n          </el-form-item>\n          \n          <el-form-item label=\"分区\" prop=\"label\" style=\"margin-top: 20px;display:inline;\">\n            <el-select v-model=\"form.label\" placeholder=\"请选择分区\">\n              <el-option label=\"娱乐\" value=\"娱乐\"></el-option>\n              <el-option label=\"生活\" value=\"生活\"></el-option>\n              <el-option label=\"学习\" value=\"学习\"></el-option>\n              <el-option label=\"游戏\" value=\"游戏\"></el-option>\n              <el-option label=\"运动\" value=\"运动\"></el-option>\n              <el-option label=\"美食\" value=\"美食\"></el-option>\n              <el-option label=\"音乐\" value=\"音乐\"></el-option>\n              <el-option label=\"影视\" value=\"影视\"></el-option>\n              <el-option label=\"科技\" value=\"科技\"></el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item label=\"简介\" prop=\"description\" style=\"margin-top: 20px;width:100%\">\n              <el-input v-model=\"form.description\"></el-input>\n          </el-form-item>\n        </div>\n        \n        <!-- <div class=\"upload_video\" prop=\"video\">\n          <el-input v-model=\"form.video\" id=\"upload_video\" type=\"file\" ref=\"fileInput\" accept=\".mp4\"  style=\"display:none\"/>\n          <label for=\"upload_video\">\n            <img src=\"../assets/upload/cloud_upload.svg\" style=\"opacity:0.6\">\n          </label>\n          <div>请在此处选择视频</div>\n        </div> -->\n      <el-button @click=\"uploadVideo\" style=\"margin-top:20px;\">上传</el-button>\n      <div v-if=\"uploading\">\n        <p>正在上传...</p>\n        <el-progress :percentage=\"uploadProgress\" :show-text=\"false\" class=\"progress-bar\"></el-progress>\n      </div>\n    </el-form>\n  </div>\n  </div>\n</template>\n<script>\nimport axios from 'axios'\nexport default {\n  data() {\n    return {\n      file: null,          // 选择的视频文件对象\n      uploading: false,    // 是否正在上传\n      uploadProgress: 0,  // 上传进度，0-100\n      dialogImageUrl: '',\n      dialogVisible: false,\n      form:{\n        video:'',\n        cover:'',\n        title:'',\n        label:'',\n        description:'',\n      }\n    }\n    \n  },\n  computed: {\n    // coverUrl() {\n    //   return this.form.cover ? `data:image/jpeg;base64,${this.form.cover}` : require(\"../assets/upload/upload_cover.png\");\n    // },\n  },\n\n  methods: {\n    handleRemove(file, fileList) {\n        console.log(file, fileList);\n      },\n      handlePictureCardPreview(file) {\n        this.dialogImageUrl = file.url;\n        this.dialogVisible = true;\n      },\n    uploadVideo(){\n      if (!this.form.video) {\n          alert('请先选择视频文件');\n          return;\n        }\n      this.uploading = true;\n      let formData=new FormData();\n      formData.append(\"video_file\",this.form.video);\n      formData.append(\"cover_file\",this.form.cover);\n      formData.append(\"label\",this.form.label);\n      formData.append(\"title\",this.form.title);\n      formData.append(\"description\",this.form.description);\n      console.log(this.form);\n      axios.post('/videos/upload_video',formData, {\n          onUploadProgress: progressEvent => {\n            this.uploadProgress = Math.round((progressEvent.loaded * 100) / progressEvent.total);\n            console.log(this.uploadProgress);\n          }\n        })\n      .then((res)=>{\n        if(res.errorno==0){ \n          alert(\"上传成功\");\n         \n        }else {\n            alert(res.data.msg)\n          }\n          console.log(res.data.msg);\n          this.uploading=false;\n          this.uploadProgress=0;\n          // this.uploadProgress = { value: 0, displayValue: '0%' };\n      })\n    }\n\n  }\n}\n</script>\n<style >\n.upload-form{\n  width: 500px;\n  margin: 50px auto;\n  background-color: rgba(198, 231, 244, 0.95);\n  padding: 30px;\n  border-radius: 10px;\n  opacity: 0.7;\n}\n.video_info{\n  display: flex; \n  flex-direction: column; \n  align-items: flex-start;\n}\n.el-form-item__label {\n  text-align: left;\n  font-family: Arial, sans-serif;\n  font-size: 16px;\n  font-weight: bold;\n  color: #333;\n  \n}\n.el-form-item{\n  opacity: 1;\n}\n.upload-body{\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  background-image:url('../assets/upload/upload_background.jpeg');\n  background-size: 100% 100%;\n}\n.progress-bar {\n  -webkit-animation: progress-bar-animation 2s ease-out forwards;\n  animation: progress-bar-animation 2s ease-out forwards;\n}\n\n@-webkit-keyframes progress-bar-animation {\n  from {\n    width: 0%;\n  }\n  to {\n    width: 100%;\n  }\n}\n\n@keyframes progress-bar-animation {\n  from {\n    width: 0%;\n  }\n  to {\n    width: 100%;\n  }\n}\n\n</style>"],"mappings":";;AAsEA,OAAAA,KAAA;AACA;EACAC,IAAA,WAAAA,KAAA;IACA;MACAC,IAAA;MAAA;MACAC,SAAA;MAAA;MACAC,cAAA;MAAA;MACAC,cAAA;MACAC,aAAA;MACAC,IAAA;QACAC,KAAA;QACAC,KAAA;QACAC,KAAA;QACAC,KAAA;QACAC,WAAA;MACA;IACA;EAEA;EACAC,QAAA;IACA;IACA;IACA;EAAA,CACA;EAEAC,OAAA;IACAC,YAAA,WAAAA,aAAAb,IAAA,EAAAc,QAAA;MACAC,OAAA,CAAAC,GAAA,CAAAhB,IAAA,EAAAc,QAAA;IACA;IACAG,wBAAA,WAAAA,yBAAAjB,IAAA;MACA,KAAAG,cAAA,GAAAH,IAAA,CAAAkB,GAAA;MACA,KAAAd,aAAA;IACA;IACAe,WAAA,WAAAA,YAAA;MAAA,IAAAC,KAAA;MACA,UAAAf,IAAA,CAAAC,KAAA;QACAe,KAAA;QACA;MACA;MACA,KAAApB,SAAA;MACA,IAAAqB,QAAA,OAAAC,QAAA;MACAD,QAAA,CAAAE,MAAA,oBAAAnB,IAAA,CAAAC,KAAA;MACAgB,QAAA,CAAAE,MAAA,oBAAAnB,IAAA,CAAAE,KAAA;MACAe,QAAA,CAAAE,MAAA,eAAAnB,IAAA,CAAAI,KAAA;MACAa,QAAA,CAAAE,MAAA,eAAAnB,IAAA,CAAAG,KAAA;MACAc,QAAA,CAAAE,MAAA,qBAAAnB,IAAA,CAAAK,WAAA;MACAK,OAAA,CAAAC,GAAA,MAAAX,IAAA;MACAP,KAAA,CAAA2B,IAAA,yBAAAH,QAAA;QACAI,gBAAA,WAAAA,iBAAAC,aAAA;UACAP,KAAA,CAAAlB,cAAA,GAAA0B,IAAA,CAAAC,KAAA,CAAAF,aAAA,CAAAG,MAAA,SAAAH,aAAA,CAAAI,KAAA;UACAhB,OAAA,CAAAC,GAAA,CAAAI,KAAA,CAAAlB,cAAA;QACA;MACA,GACA8B,IAAA,WAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,OAAA;UACAb,KAAA;QAEA;UACAA,KAAA,CAAAY,GAAA,CAAAlC,IAAA,CAAAoC,GAAA;QACA;QACApB,OAAA,CAAAC,GAAA,CAAAiB,GAAA,CAAAlC,IAAA,CAAAoC,GAAA;QACAf,KAAA,CAAAnB,SAAA;QACAmB,KAAA,CAAAlB,cAAA;QACA;MACA;IACA;EAEA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}